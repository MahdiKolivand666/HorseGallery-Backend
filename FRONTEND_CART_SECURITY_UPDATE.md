# ๐ ุจูโุฑูุฒุฑุณุงู ุงููุช ุณุจุฏ ุฎุฑุฏ - Frontend

ุชุงุฑุฎ: ุฏุณุงูุจุฑ 2024  
ูุถุนุช: โ Backend ุจูโุฑูุฒุฑุณุงู ุดุฏู - Frontend ูุงุฒ ุจู ุชุบุฑ ูุฏุงุฑุฏ

---

## ๐ ุฎูุงุตู ุชุบุฑุงุช

Backend ุจูโุฑูุฒุฑุณุงู ุดุฏู ุงุณุช ุชุง **ูุดฺฉูุงุช ุงููุช** ุฑุง ุจุฑุทุฑู ฺฉูุฏ:

- โ **Authorization Check ุงุถุงูู ุดุฏ** - ููุท ุตุงุญุจ ุณุจุฏ ูโุชูุงูุฏ ุจู ุขู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ
- โ **SessionId Validation** - sessionId ููุท ุจุฑุง ุณุจุฏ ุฎูุฏ ฺฉุงุฑุจุฑ ูุนุชุจุฑ ุงุณุช
- โ **CartItem Ownership Check** - ููุท ุขุชูโูุง ูุชุนูู ุจู ุณุจุฏ ฺฉุงุฑุจุฑ ูุงุจู ูุฑุงุด/ุญุฐู ูุณุชูุฏ

---

## โ๏ธ ุชุบุฑุงุช ููู

### ูุจู (ูุดฺฉู ุงููุช):

```typescript
// โ ูุฑ ฺฉุณ ูโุชูุงูุณุช ุจุง ID ุณุจุฏ ุฏฺฏุฑุงูุ ุณุจุฏ ุขูโูุง ุฑุง ุจุจูุฏ
GET /site/cart/507f1f77bcf86cd799439011
// ูฺ ุจุฑุฑุณ authorization ูุฌูุฏ ูุฏุงุดุช!
```

### ุจุนุฏ (ุงูู):

```typescript
// โ ููุท ุตุงุญุจ ุณุจุฏ ูโุชูุงูุฏ ุจู ุขู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ
GET /site/cart/507f1f77bcf86cd799439011
// Backend ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู:
// - ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏุ ุณุจุฏ ูุชุนูู ุจู ุงู ฺฉุงุฑุจุฑ ุงุณุช
// - ุงฺฏุฑ ูููุงู ุจุงุดุฏุ ุณุจุฏ ูุชุนูู ุจู ุงู sessionId ุงุณุช
```

---

## ๐ ุชุบุฑุงุช API

### ููู Endpoint ูุง ุจุง ID ุญุงูุง ูุงุฒ ุจู Authorization ุฏุงุฑูุฏ

#### 1๏ธโฃ ุฏุฑุงูุช ุฌุฒุฆุงุช ุณุจุฏ ุฎุฑุฏ

**GET** `/site/cart/:id`

**ุชุบุฑ:** ุญุงูุง Backend ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุขุง ุดูุง ุตุงุญุจ ุงู ุณุจุฏ ูุณุชุฏ ุง ูู.

**Request Headers:**

```http
# ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏ:
Authorization: Bearer <token>

# ุงฺฏุฑ ูููุงู ุจุงุดุฏ:
Cookie: sessionId=<sessionId>
```

**Response (403 Forbidden):**

ุงฺฏุฑ ุณุจุฏ ูุชุนูู ุจู ุดูุง ูุจุงุดุฏ:

```json
{
  "statusCode": 403,
  "message": "ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ",
  "error": "Forbidden"
}
```

---

#### 2๏ธโฃ ูุฑุงุด ุขุชู ุณุจุฏ ุฎุฑุฏ

**PATCH** `/site/cart/edit-cart-item/:id`

**ุชุบุฑ:** ุญุงูุง Backend ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู:

- ุณุจุฏ ูุชุนูู ุจู ุดูุง ุงุณุช
- ุขุชู ูุชุนูู ุจู ุงู ุณุจุฏ ุงุณุช

**Response (403 Forbidden):**

```json
{
  "statusCode": 403,
  "message": "ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ",
  "error": "Forbidden"
}
```

ุง:

```json
{
  "statusCode": 403,
  "message": "ุงู ุขุชู ูุชุนูู ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุณุช",
  "error": "Forbidden"
}
```

---

#### 3๏ธโฃ ุงูุฒูุฏู ูุญุตูู ุจู ุณุจุฏ

**PATCH** `/site/cart/add-to-cart/:id`

**ุชุบุฑ:** ุญุงูุง Backend ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู ุณุจุฏ ูุชุนูู ุจู ุดูุง ุงุณุช.

---

#### 4๏ธโฃ ุญุฐู ุขุชู ุงุฒ ุณุจุฏ

**DELETE** `/site/cart/remove-from-cart/:id`

**ุชุบุฑ:** ุญุงูุง Backend ุจุฑุฑุณ ูโฺฉูุฏ ฺฉู:

- ุณุจุฏ ูุชุนูู ุจู ุดูุง ุงุณุช
- ุขุชู ูุชุนูู ุจู ุงู ุณุจุฏ ุงุณุช

---

## ๐ป ุชุบุฑุงุช ููุฑุฏ ูุงุฒ ุฏุฑ Frontend

### โ ูฺ ุชุบุฑ ฺฉุฏ ูุงุฒ ูุณุช!

Backend ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ authorization ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ. Frontend ููุท ุจุงุฏ:

1. โ **JWT Token ุฑุง ุงุฑุณุงู ฺฉูุฏ** (ุงฺฏุฑ ูุงฺฏู ุจุงุดุฏ)
2. โ **sessionId ุฑุง ุฏุฑ Cookie ุงุฑุณุงู ฺฉูุฏ** (ุงฺฏุฑ ูููุงู ุจุงุดุฏ)
3. โ **ุฎุทุงูุง 403 ุฑุง handle ฺฉูุฏ**

---

## ๐ก๏ธ ูุฏุฑุช ุฎุทุงูุง

### ูุซุงู: Handle ฺฉุฑุฏู ุฎุทุง 403

```typescript
// lib/api/cart.ts
export async function getCartDetails(cartId: string): Promise<CartResponse> {
  const token = getToken();
  const sessionId = getSessionId();

  const headers: HeadersInit = {
    'Content-Type': 'application/json',
  };

  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }

  try {
    const response = await fetch(`${API_BASE_URL}/site/cart/${cartId}`, {
      method: 'GET',
      credentials: 'include',
      headers,
    });

    if (!response.ok) {
      if (response.status === 403) {
        // ุฏุณุชุฑุณ ูุฏุงุฑุฏ - ุงุญุชูุงูุงู ุณุจุฏ ูุชุนูู ุจู ุดูุง ูุณุช
        throw new Error('ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ');
      }

      if (response.status === 404) {
        // ุณุจุฏ ูุฌูุฏ ูุฏุงุฑุฏ ุง ูููุถ ุดุฏู
        throw new Error('ุณุจุฏ ุฎุฑุฏ ุงูุช ูุดุฏ');
      }

      throw new Error('ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุณุจุฏ ุฎุฑุฏ');
    }

    return response.json();
  } catch (error) {
    console.error('ุฎุทุง ุฏุฑ ุฏุฑุงูุช ุณุจุฏ ุฎุฑุฏ:', error);
    throw error;
  }
}
```

---

## โ๏ธ ูฺฉุงุช ููู

### 1. ุงุณุชูุงุฏู ุงุฒ ID ุณุจุฏ

**โ ุบูุท:**

```typescript
// ุงุณุชูุงุฏู ูุณุชูู ุงุฒ ID ุณุจุฏ ุฏฺฏุฑุงู
const cartId = '507f1f77bcf86cd799439011'; // ID ุณุจุฏ ฺฉุงุฑุจุฑ ุฏฺฏุฑ
await getCartDetails(cartId); // ุฎุทุง 403 ูโุฏูุฏ
```

**โ ุฏุฑุณุช:**

```typescript
// ุงุณุชูุงุฏู ุงุฒ ุณุจุฏ ุฎูุฏ ฺฉุงุฑุจุฑ
const cart = await getCart(); // ุณุจุฏ ุฎูุฏ ฺฉุงุฑุจุฑ
const cartId = cart.cart._id;
await getCartDetails(cartId); // ฺฉุงุฑ ูโฺฉูุฏ
```

### 2. ูุฏุฑุช ุฎุทุงูุง

```typescript
try {
  const cart = await getCartDetails(cartId);
} catch (error) {
  if (error.message === 'ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ') {
    // ุณุจุฏ ูุชุนูู ุจู ุดูุง ูุณุช - ุจู ุตูุญู ุงุตู redirect ฺฉูุฏ
    router.push('/cart');
  } else if (error.message === 'ุณุจุฏ ุฎุฑุฏ ุงูุช ูุดุฏ') {
    // ุณุจุฏ ูุฌูุฏ ูุฏุงุฑุฏ ุง ูููุถ ุดุฏู
    router.push('/cart');
  }
}
```

### 3. ุงุณุชูุงุฏู ุงุฒ Endpoint ูุง ุตุญุญ

**โ ุงุณุชูุงุฏู ุงุฒ endpoint ุจุฏูู ID:**

```typescript
// ุจุฑุง ุฏุฑุงูุช ุณุจุฏ ุฎูุฏ ฺฉุงุฑุจุฑ
const cart = await getCart(); // GET /site/cart
// Backend ุฎูุฏุด ุณุจุฏ ฺฉุงุฑุจุฑ ุฑุง ูพุฏุง ูโฺฉูุฏ
```

**โ๏ธ ุงุณุชูุงุฏู ุงุฒ endpoint ุจุง ID (ููุท ุฏุฑ ุตูุฑุช ูุงุฒ):**

```typescript
// ููุท ุงฺฏุฑ ID ุณุจุฏ ุฑุง ุฏุงุฑุฏ ู ูุทูุฆู ูุณุชุฏ ฺฉู ูุชุนูู ุจู ุดูุงุณุช
const cart = await getCartDetails(cartId); // GET /site/cart/:id
```

---

## ๐งช ุชุณุช

### ุชุณุช 1: ุฏุณุชุฑุณ ุจู ุณุจุฏ ุฎูุฏ

```typescript
// ุจุงุฏ ฺฉุงุฑ ฺฉูุฏ
const cart = await getCart();
const cartDetails = await getCartDetails(cart.cart._id);
expect(cartDetails).toBeDefined();
```

### ุชุณุช 2: ุฏุณุชุฑุณ ุจู ุณุจุฏ ุฏฺฏุฑุงู

```typescript
// ุจุงุฏ ุฎุทุง 403 ุจุฏูุฏ
const otherCartId = '507f1f77bcf86cd799439011'; // ID ุณุจุฏ ฺฉุงุฑุจุฑ ุฏฺฏุฑ
try {
  await getCartDetails(otherCartId);
  fail('ุจุงุฏ ุฎุทุง ุจุฏูุฏ');
} catch (error) {
  expect(error.message).toBe('ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ');
}
```

### ุชุณุช 3: ูุฑุงุด ุณุจุฏ ุฏฺฏุฑุงู

```typescript
// ุจุงุฏ ุฎุทุง 403 ุจุฏูุฏ
try {
  await editCartItem(otherCartId, { cartItem: '...', quantity: 2 });
  fail('ุจุงุฏ ุฎุทุง ุจุฏูุฏ');
} catch (error) {
  expect(error.message).toBe('ุฏุณุชุฑุณ ุจู ุงู ุณุจุฏ ุฎุฑุฏ ูุฏุงุฑุฏ');
}
```

---

## ๐ ฺฺฉโูุณุช

- [x] Backend authorization check ุงุถุงูู ุดุฏ
- [x] SessionId validation ุงุถุงูู ุดุฏ
- [x] CartItem ownership check ุงุถุงูู ุดุฏ
- [ ] Frontend ุฎุทุงูุง 403 ุฑุง handle ูโฺฉูุฏ (ุงุฎุชุงุฑ - ููุท ุจุฑุง UX ุจูุชุฑ)
- [ ] Frontend ุงุฒ endpoint ูุง ุตุญุญ ุงุณุชูุงุฏู ูโฺฉูุฏ

---

## ๐ฏ ุฎูุงุตู

### ุชุบุฑุงุช Backend:

1. โ **Authorization Check** ุฏุฑ ููู endpoint ูุง ุจุง ID ุงุถุงูู ุดุฏ
2. โ **SessionId Validation** ุงุถุงูู ุดุฏ
3. โ **CartItem Ownership Check** ุงุถุงูู ุดุฏ

### ุชุบุฑุงุช Frontend:

- โ **ูฺ ุชุบุฑ ฺฉุฏ ูุงุฒ ูุณุช!**
- โ๏ธ ููุท ุจุงุฏ ุฎุทุงูุง 403 ุฑุง handle ฺฉูุฏ (ุงุฎุชุงุฑ)

---

## ๐ ูพุดุชุจุงู

ุงฺฏุฑ ูุดฺฉู ุฏุงุดุชุฏ:

1. โ ุจุฑุฑุณ ฺฉูุฏ ฺฉู JWT Token ุง sessionId ุฑุง ุงุฑุณุงู ูโฺฉูุฏ
2. โ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุงุฒ ID ุณุจุฏ ุฎูุฏุชุงู ุงุณุชูุงุฏู ูโฺฉูุฏ
3. โ Response ุฑุง ุฏุฑ Console/Network tab ุจุฑุฑุณ ฺฉูุฏ

---

**ูููู ุจุงุดุฏ! ๐**
