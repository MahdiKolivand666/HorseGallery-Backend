# ๐ฑ ุฑุงูููุง ุฑุงูโุงูุฏุงุฒ ุณุฑูุณ SMS

## โ ฺฉุฏูุง ูพุงุฏูโุณุงุฒ ุดุฏูุฏ

ุชูุงู ฺฉุฏูุง ููุฑุฏ ูุงุฒ ุจุฑุง ุงุฑุณุงู SMS ุงุถุงูู ุดุฏู ุงุณุช. ุญุงูุง ููุท ุจุงุฏ ูพูู SMS ุฑุง ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ.

---

## ๐ ุฑุงูโุงูุฏุงุฒ ุณุฑุน (Development)

### ฺฏุงู 1: ฺฉูพ ฺฉุฑุฏู Environment Variables

```bash
cp .env.example .env
```

### ฺฏุงู 2: ูุฑุงุด ูุงู .env

ูุนูุงู ูููโูุง ฺฉุงู ุงุณุช:
```env
SMS_ENABLED=false
```

ุจุง ุงู ุชูุธูุ ฺฉุฏูุง ุฏุฑ Console ููุงุด ุฏุงุฏู ูโุดููุฏ ู SMS ูุงูุน ุงุฑุณุงู ููโุดูุฏ.

### ฺฏุงู 3: Build ู ุงุฌุฑุง

```bash
npm run build
npm start
```

---

## ๐ฑ ุชุณุช ฺฉุฑุฏู

### 1. ุซุจุชโูุงู ฺฉุงุฑุจุฑ ุฌุฏุฏ

```bash
POST http://localhost:4001/auth/sign-up

Body:
{
  "mobile": "09123456789",
  "password": "Test123",
  "firstName": "ุนู",
  "lastName": "ุงุญูุฏ"
}
```

### 2. ูุดุงูุฏู ฺฉุฏ ุฏุฑ Console

ุจุนุฏ ุงุฒ ุซุจุชโูุงูุ ุฏุฑ terminal ฺฉุฏ ุชุงุฏ ููุงุด ุฏุงุฏู ูโุดูุฏ:
```
โ๏ธ SMS is disabled (Development Mode)
๐ฑ Verification code for 09123456789: 123456
๐ Would send SMS using Kavenegar template: verify
```

### 3. ุชุงุฏ ฺฉุฏ

```bash
POST http://localhost:4001/auth/confirm

Body:
{
  "mobile": "09123456789",
  "code": "123456"
}
```

---

## ๐ฎ๐ท ุฑุงูโุงูุฏุงุฒ Production (ุจุง SMS ูุงูุน)

### ูุฑุญูู 1: ุซุจุชโูุงู ุฏุฑ ฺฉุงููโูฺฏุงุฑ

1. ุจู ุณุงุช ุจุฑูุฏ: https://kavenegar.com
2. ุฑู "ุซุจุชโูุงู" ฺฉูฺฉ ฺฉูุฏ
3. ุงุทูุงุนุงุช ุฎูุฏ ุฑุง ูุงุฑุฏ ฺฉูุฏ
4. ุดูุงุฑู ููุจุงู ุฎูุฏ ุฑุง ุชุงุฏ ฺฉูุฏ

### ูุฑุญูู 2: ุฏุฑุงูุช API Key

1. ูุงุฑุฏ ูพูู ุดูุฏ
2. ุงุฒ ููู ุณูุช ฺูพุ ุฑู "ุชูุธูุงุช" ฺฉูฺฉ ฺฉูุฏ
3. "ูุฏุฑุช APIKey" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
4. API Key ุฎูุฏ ุฑุง ฺฉูพ ฺฉูุฏ

### ูุฑุญูู 3: ุงุฌุงุฏ ูพุชุฑู (Template)

1. ุงุฒ ููู ฺูพุ "ุงุฑุณุงู ูพุชุฑู" ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ
2. "ุงุฌุงุฏ ูพุชุฑู ุฌุฏุฏ" ุฑุง ฺฉูฺฉ ฺฉูุฏ
3. ุงุทูุงุนุงุช ุฒุฑ ุฑุง ูุงุฑุฏ ฺฉูุฏ:

```
ูุงู ูพุชุฑู: verify
ูุชู ูพุงู: ฺฉุฏ ุชุงุฏ ุดูุง: {token}
```

4. ูพุชุฑู ุฑุง ุฐุฎุฑู ฺฉูุฏ

### ูุฑุญูู 4: ุชูุธู Environment Variables

ุฏุฑ ูุงู `.env`:

```env
# ูุนุงู ฺฉุฑุฏู SMS ูุงูุน
SMS_ENABLED=true

# API Key ุงุฒ ูพูู ฺฉุงููโูฺฏุงุฑ
SMS_API_KEY=YOUR_ACTUAL_API_KEY_HERE

# ุดูุงุฑู ูุฑุณุชูุฏู (ูพุดโูุฑุถ ฺฉุงููโูฺฏุงุฑ)
SMS_SENDER=10008566

# ูุงู ูพุชุฑู ฺฉู ุณุงุฎุชุฏ
SMS_TEMPLATE=verify
```

### ูุฑุญูู 5: ุดุงุฑฺ ุญุณุงุจ

1. ุฏุฑ ูพูู ฺฉุงููโูฺฏุงุฑุ "ุดุงุฑฺ ุญุณุงุจ" ุฑุง ฺฉูฺฉ ฺฉูุฏ
2. ูุจูุบ ุฏูุฎูุงู ุฑุง ุดุงุฑฺ ฺฉูุฏ (ูุฑ SMS ุญุฏูุฏ 50 ุชููุงู)
3. ุจุฑุง ุดุฑูุนุ 50,000 ุชููุงู ฺฉุงู ุงุณุช

### ูุฑุญูู 6: ุชุณุช

```bash
# Restart ฺฉุฑุฏู ุณุฑูุฑ
npm start

# ุซุจุชโูุงู ุจุง ุดูุงุฑู ูุงูุน
POST /auth/sign-up
{
  "mobile": "09123456789",
  "password": "Test123",
  "firstName": "ุนู",
  "lastName": "ุงุญูุฏ"
}
```

ุจุงุฏ SMS ูุงูุน ุฏุฑุงูุช ฺฉูุฏ! ๐

---

## ๐ง ูฺฺฏโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

### โ ุงููุช

1. **Hash ฺฉุฑุฏู ฺฉุฏ**: ฺฉุฏ ุฏุฑ ุฏุชุงุจุณ ุจู ุตูุฑุช hash ุฐุฎุฑู ูโุดูุฏ
2. **ุงููุถุง ุฒูุงู**: ฺฉุฏ ุจุนุฏ ุงุฒ 2 ุฏููู ูููุถ ูโุดูุฏ
3. **ูุญุฏูุฏุช ุชูุงุด**: ุญุฏุงฺฉุซุฑ 3 ุจุงุฑ ูโุชูุงู ฺฉุฏ ุงุดุชุจุงู ูุงุฑุฏ ฺฉุฑุฏ
4. **Rate Limiting**: 
   - ุญุฏุงฺฉุซุฑ 3 ฺฉุฏ ุฏุฑ ุณุงุนุช
   - ุญุฏุงูู 60 ุซุงูู ุจู ูุฑ ุฏุฑุฎูุงุณุช

### โ User Experience

1. **ูพุงูโูุง ูุงุถุญ**: ูพุงูโูุง ุฎุทุง ุจู ูุงุฑุณ ู ูุงุจู ููู
2. **ุฒูุงู ุจุงูโูุงูุฏู**: ุจู ฺฉุงุฑุจุฑ ูโฺฏูุฏ ฺูุฏ ุซุงูู ุจุงุฏ ุตุจุฑ ฺฉูุฏ
3. **ุชูุงุดโูุง ุจุงูโูุงูุฏู**: ูุดุงู ูโุฏูุฏ ฺูุฏ ุจุงุฑ ุฏฺฏุฑ ูโุชูุงูุฏ ุชูุงุด ฺฉูุฏ
4. **ูพุงู ููููุช**: ุงุทูุงุน ูโุฏูุฏ ฺฉุฏ ุงุฑุณุงู ุดุฏ

### โ Logging

1. **Development Mode**: ฺฉุฏ ุฏุฑ console ููุงุด ุฏุงุฏู ูโุดูุฏ
2. **Production Mode**: ููุท ูุงฺฏ ุงุฑุณุงู ูููู/ูุงูููู
3. **ุฎุทุงูุง**: ุชูุงู ุฎุทุงูุง ูุงฺฏ ูโุดููุฏ

---

## ๐ ููุฏูุง ุฌุฏุฏ ุฏุฑ User Schema

```typescript
{
  code: string;              // ฺฉุฏ hash ุดุฏู
  codeExpiry: Date;          // ุฒูุงู ุงููุถุง (2 ุฏููู)
  codeAttempts: number;      // ุชุนุฏุงุฏ ุชูุงุดโูุง ุงุดุชุจุงู (ุญุฏุงฺฉุซุฑ 3)
  lastCodeSentAt: Date;      // ุฒูุงู ุขุฎุฑู ุงุฑุณุงู ฺฉุฏ
  codeSentCount: number;     // ุชุนุฏุงุฏ ฺฉุฏูุง ุงุฑุณุงู ุดุฏู ุฏุฑ ุณุงุนุช ฺฏุฐุดุชู
}
```

---

## ๐ฏ API ูุง ุจูโุฑูุฒุฑุณุงู ุดุฏู

### POST /auth/sign-up
ุซุจุชโูุงู ู ุงุฑุณุงู ฺฉุฏ ุชุงุฏ

**Response (ูููู):**
```json
{
  "message": "ฺฉุฏ ุชุงุฏ ุจุง ููููุช ุงุฑุณุงู ุดุฏ",
  "expiresIn": "2 ุฏููู"
}
```

**Response (ุฎุทุง - Rate Limit):**
```json
{
  "statusCode": 400,
  "message": "ูุทูุงู 45 ุซุงูู ุฏฺฏุฑ ุตุจุฑ ฺฉูุฏ"
}
```

### POST /auth/confirm
ุชุงุฏ ฺฉุฏ ู ุฏุฑุงูุช JWT Token

**Response (ูููู):**
```json
{
  "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "_id": "...",
    "mobile": "09123456789",
    "firstName": "ุนู",
    "lastName": "ุงุญูุฏ",
    "role": "user"
  }
}
```

**Response (ุฎุทุง - ฺฉุฏ ุงุดุชุจุงู):**
```json
{
  "statusCode": 400,
  "message": "ฺฉุฏ ุงุดุชุจุงู ุงุณุช. 2 ุชูุงุด ุจุงู ูุงูุฏู"
}
```

### POST /auth/resend
ุงุฑุณุงู ูุฌุฏุฏ ฺฉุฏ

**Response:**
```json
{
  "message": "ฺฉุฏ ุชุงุฏ ุจุง ููููุช ุงุฑุณุงู ุดุฏ",
  "expiresIn": "2 ุฏููู"
}
```

---

## ๐ ุจุฑุฑุณ ูุถุนุช SMS Service

ูโุชูุงูุฏ ฺฉ endpoint ุจุฑุง ฺฺฉ ฺฉุฑุฏู ูุถุนุช ุงุถุงูู ฺฉูุฏ:

```typescript
// ุฏุฑ auth.controller.ts
@Get('sms-status')
getSmsStatus() {
  return this.smsService.getStatus();
}
```

**Response:**
```json
{
  "enabled": false,
  "hasApiKey": false,
  "sender": "10008566",
  "template": "verify",
  "provider": "Kavenegar"
}
```

---

## โ๏ธ ูฺฉุงุช ููู

### 1. ุงููุช
- **ูุฑฺฏุฒ** ฺฉุฏ ุฑุง ุฏุฑ production ูุงฺฏ ูฺฉูุฏ
- ููุดู ุงุฒ HTTPS ุงุณุชูุงุฏู ฺฉูุฏ
- API Key ุฑุง ุฏุฑ `.env` ูฺฏู ุฏุงุฑุฏ ู commit ูฺฉูุฏ

### 2. ูุฒูู
- ูุฑ SMS ุญุฏูุฏ 50-100 ุชููุงู
- ุจุฑุง 1000 ฺฉุงุฑุจุฑ: ุญุฏูุฏ 50,000-100,000 ุชููุงู
- ุญุชูุงู ุงุนุชุจุงุฑ ฺฉุงู ุดุงุฑฺ ฺฉูุฏ

### 3. ูุญุฏูุฏุชโูุง
- ฺฉุงููโูฺฏุงุฑ: ุญุฏูุฏ 10 SMS ุฏุฑ ุซุงูู
- ุจุฑุง ุญุฌู ุจุงูุง ุจุง ูพุดุชุจุงู ุชูุงุณ ุจฺฏุฑุฏ

### 4. Monitoring
- ุชุนุฏุงุฏ SMS ูุง ุงุฑุณุงู ุดุฏู ุฑุง monitor ฺฉูุฏ
- ุงฺฏุฑ ุจุด ุงุฒ ุญุฏ ุฒุงุฏ ุดุฏุ ุงุญุชูุงูุงู attack ูุณุช
- ุฏุฑ ุตูุฑุช ูุงุฒ Captcha ุงุถุงูู ฺฉูุฏ

---

## ๐ ุนุจโุงุจ

### ุฎุทุง: "ุฎุทุง ุฏุฑ ุงุฑุณุงู ูพุงูฺฉ"

**ุนูุชโูุง ูุญุชูู:**
1. API Key ุงุดุชุจุงู ุงุณุช
2. ุงุนุชุจุงุฑ ุญุณุงุจ ุชูุงู ุดุฏู
3. ูพุชุฑู ุฏุฑ ูพูู ุณุงุฎุชู ูุดุฏู
4. ุดูุงุฑู ููุจุงู ูุฑูุช ุตุญุญ ูุฏุงุฑุฏ

**ุฑุงู ุญู:**
1. API Key ุฑุง ุฏุฑ ูพูู ฺฺฉ ฺฉูุฏ
2. ููุฌูุฏ ุญุณุงุจ ุฑุง ุจุฑุฑุณ ฺฉูุฏ
3. ูพุชุฑู `verify` ุฑุง ุฏุฑ ูพูู ุจุณุงุฒุฏ
4. ุดูุงุฑู ููุจุงู ุจุงุฏ 09xxxxxxxxx ุจุงุดุฏ

### ฺฉุฏ ุฏุฑ Console ููุงุด ุฏุงุฏู ููโุดูุฏ

**ุจุฑุฑุณ ฺฉูุฏ:**
1. `SMS_ENABLED=false` ุฏุฑ `.env` ุงุณุชุ
2. Server ุฑุง restart ฺฉุฑุฏุฏุ
3. ูุงฺฏโูุง terminal ุฑุง ุจุฑุฑุณ ฺฉูุฏ

---

## ๐ ูพุดุชุจุงู ฺฉุงููโูฺฏุงุฑ

- ูุจุณุงุช: https://kavenegar.com
- ูพุดุชุจุงู: https://panel.kavenegar.com/client/ticket
- ุชูฺฏุฑุงู: @kavenegarbot
- ุชููู: 021-91013009

---

## ๐ ุฎูุงุตู

โ ฺฉุฏูุง ุขูุงุฏู ูุณุชูุฏ  
โ ุฏุฑ Development ฺฉุงุฑ ูโฺฉูุฏ (ฺฉุฏ ุฏุฑ console)  
โ ุจุฑุง Production ููุท ุจุงุฏ:
   1. ุฏุฑ kavenegar.com ุซุจุชโูุงู ฺฉูุฏ
   2. API Key ุจฺฏุฑุฏ
   3. ูพุชุฑู ุจุณุงุฒุฏ
   4. ุฏุฑ `.env` ุชูุธู ฺฉูุฏ: `SMS_ENABLED=true`

ูููู ุจุงุดุฏ! ๐

