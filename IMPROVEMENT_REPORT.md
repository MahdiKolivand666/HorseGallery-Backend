# Ú¯Ø²Ø§Ø±Ø´ Ø¨Ø±Ø±Ø³ÛŒ Ùˆ Ø¨Ù‡Ø¨ÙˆØ¯ Ù¾Ø±ÙˆÚ˜Ù‡ Gold Gallery Backend

**ØªØ§Ø±ÛŒØ®:** 2025-02-11  
**Ù†Ø³Ø®Ù‡ Ù¾Ø±ÙˆÚ˜Ù‡:** NestJS Backend  
**Ù‡Ø¯Ù:** Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Ø³Ø§ÛŒØª Gold Gallery

---

## ğŸ“‹ ÙÙ‡Ø±Ø³Øª Ù…Ø·Ø§Ù„Ø¨

1. [Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ù¾Ø±ÙˆÚ˜Ù‡](#Ù†Ù‚Ø§Ø·-Ù‚ÙˆØª-Ù¾Ø±ÙˆÚ˜Ù‡)
2. [Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯](#Ù…Ø´Ú©Ù„Ø§Øª-Ùˆ-Ù†ÛŒØ§Ø²-Ø¨Ù‡-Ø¨Ù‡Ø¨ÙˆØ¯)
3. [Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª Ø¨Ù‡Ø¨ÙˆØ¯](#Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯Ø§Øª-Ø¨Ù‡Ø¨ÙˆØ¯)
4. [Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ](#Ú†Ú©â€ŒÙ„ÛŒØ³Øª-Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ)
5. [Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ](#Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ-Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ)

---

## âœ… Ù†Ù‚Ø§Ø· Ù‚ÙˆØª Ù¾Ø±ÙˆÚ˜Ù‡

### 1. Ø³Ø§Ø®ØªØ§Ø± Ù…Ù†Ø¸Ù…

- âœ… Ù…Ø§Ú˜ÙˆÙ„â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ùˆ Ù…Ù†Ø¸Ù…
- âœ… Ø¬Ø¯Ø§Ø³Ø§Ø²ÛŒ Controller, Service, DTO, Schema
- âœ… Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² NestJS Best Practices

### 2. Ù…Ø³ØªÙ†Ø¯Ø³Ø§Ø²ÛŒ

- âœ… Swagger Integration Ø¨Ø±Ø§ÛŒ API Documentation
- âœ… Ú©Ø§Ù…Ù†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¯Ø± Ú©Ø¯
- âœ… ÙØ§ÛŒÙ„ SETUP.md Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ

### 3. Ø§Ù…Ù†ÛŒØª

- âœ… JWT Authentication
- âœ… Role-based Authorization
- âœ… Helmet Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª HTTP Headers
- âœ… Rate Limiting Ø¨Ø§ Throttler

### 4. Ù‚Ø§Ø¨Ù„ÛŒØªâ€ŒÙ‡Ø§

- âœ… Ø³ÛŒØ³ØªÙ… Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§Ù†Ú©ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø´Ø¯Ù‡
- âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø­ØµÙˆÙ„Ø§Øª Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ
- âœ… Ø³Ø¨Ø¯ Ø®Ø±ÛŒØ¯ Ùˆ Ø³ÙØ§Ø±Ø´
- âœ… Ø³ÛŒØ³ØªÙ… ØªÛŒÚ©Øª Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ
- âœ… SEO Management
- âœ… Ù…Ø¯ÛŒØ±ÛŒØª Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ùˆ Ø§Ø­Ø±Ø§Ø² Ù‡ÙˆÛŒØª

---

## âš ï¸ Ù…Ø´Ú©Ù„Ø§Øª Ùˆ Ù†ÛŒØ§Ø² Ø¨Ù‡ Ø¨Ù‡Ø¨ÙˆØ¯

### ğŸ”´ Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ (Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§)

#### 1. JWT Guard - Ø¹Ø¯Ù… Ù¾Ø±ØªØ§Ø¨ Ø®Ø·Ø§ÛŒ Ù…Ù†Ø§Ø³Ø¨

**ÙØ§ÛŒÙ„:** `src/shared/guards/jwt.guard.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
catch (error) {
  return false; // âŒ Ø¨Ø§ÛŒØ¯ Ø®Ø·Ø§ Ù¾Ø±ØªØ§Ø¨ Ú©Ù†Ø¯
}
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
catch (error) {
  throw new UnauthorizedException('Invalid or expired token');
}
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Frontend Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ ØªÙØ§ÙˆØª Ø¨ÛŒÙ† "token Ù†Ø¯Ø§Ø±Ù…" Ùˆ "token Ù…Ø¹ØªØ¨Ø± Ù†ÛŒØ³Øª" Ø±Ø§ ØªØ´Ø®ÛŒØµ Ø¯Ù‡Ø¯
- ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¨Ù‡ØªØ± Ø¨Ø§ Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ÛŒ ÙˆØ§Ø¶Ø­

---

#### 2. Callback URL Ø®Ø§Ù„ÛŒ Ø¯Ø± Payment

**ÙØ§ÛŒÙ„:** `src/shop/controllers/site-order.controller.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
// Ø®Ø· 48 Ùˆ 50
return response.redirect(''); // âŒ URL Ø®Ø§Ù„ÛŒ Ø§Ø³Øª!
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
// Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ù…ÙˆÙÙ‚
if (bankResponse.status === 101) {
  // ...
  await order.save();
  return response.redirect(
    `${process.env.FRONTEND_URL}/order/success?id=${order._id}`,
  );
} else {
  // ...
  return response.redirect(
    `${process.env.FRONTEND_URL}/order/failed?id=${order._id}`,
  );
}
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Ú©Ø§Ø±Ø¨Ø± Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ ØµÙØ­Ù‡ Ù…Ù†Ø§Ø³Ø¨ redirect Ø´ÙˆØ¯
- ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¶Ø¹ÛŒÙ Ø¨Ø§ redirect Ø®Ø§Ù„ÛŒ

---

#### 3. Ø¹Ø¯Ù… Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ

**ÙØ§ÛŒÙ„:** `src/shop/services/order.service.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
// Ø®Ø· 111 Ùˆ 123
const response = await axios.post(process.env.BANK_VERIFY_URL!, bankData);
// âŒ Ø§Ú¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øª fail Ø¨Ø´Ù‡ØŒ Ø®Ø·Ø§ÛŒ unhandled Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
async checkOrder(id: string) {
  try {
    const order = await this.findOneOrder(id);
    const bankData = {
      merchant_id: process.env.MERCHANT_ID,
      amount: order.finalPrice * 10,
      authority: order.refId,
    };

    const response = await axios.post(process.env.BANK_VERIFY_URL!, bankData);
    return response?.data?.data;
  } catch (error) {
    throw new BadRequestException('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ');
  }
}
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Ø®Ø·Ø§Ù‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡ ÛŒØ§ timeout Ø¨Ø§ÛŒØ¯ handle Ø´ÙˆÙ†Ø¯
- Ø¨Ø¯ÙˆÙ† try-catchØŒ Ú©Ù„ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† crash Ù…ÛŒâ€ŒÚ©Ù†Ø¯

---

#### 4. Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `any` Ø¯Ø± TypeScript

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø±:**

- `src/shop/controllers/site-order.controller.ts` (Ø®Ø· 31)
- `src/blog/services/blog.service.ts`
- `src/product/services/product.service.ts`
- `src/user/services/address.service.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
async callback(@Query() query: any, @Res() response: Response) {
  // âŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² any
}
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
class PaymentCallbackDto {
  @IsString()
  @IsOptional()
  authority?: string;

  @IsString()
  @IsOptional()
  status?: string;
}

async callback(@Query() query: PaymentCallbackDto, @Res() response: Response) {
  // âœ… type-safe
}
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Type Safety Ú©Ù…ØªØ± = Ø§Ø­ØªÙ…Ø§Ù„ bug Ø¨ÛŒØ´ØªØ±
- IDE autocomplete Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯
- Refactoring Ø±Ø§Ø­Øªâ€ŒØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯

---

### ğŸŸ¡ Ù…Ø´Ú©Ù„Ø§Øª Ú©ÛŒÙÛŒØª Ú©Ø¯

#### 5. Typo Ø¯Ø± Ù…ØªØºÛŒØ±

**ÙØ§ÛŒÙ„:** `src/shared/pipes/farsi.pipe.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
const errrors: string[] = []; // âŒ Ø³Ù‡ ØªØ§ r
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
const errors: string[] = []; // âœ…
```

---

#### 6. Import Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡

**ÙØ§ÛŒÙ„:** `src/app.module.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
import { request } from 'axios'; // âŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
// Ø­Ø°Ù Ø§ÛŒÙ† import
```

---

#### 7. Console.log Ø¯Ø± Production Code

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø±:**

- `src/shared/utils/file-utils.ts` (Ø®Ø· 46)
- `src/seo/services/seo.service.ts` (Ø®Ø· 52)
- `src/user/services/user.service.ts` (Ø®Ø· 127)
- `src/shared/guards/api-key.guard.ts` (Ø®Ø· 11-12)

**Ù…Ø´Ú©Ù„:**

```typescript
console.log('Error deleting images:', error); // âŒ Ø¯Ø± production Ù†Ø¨Ø§ÛŒØ¯ Ø¨Ø§Ø´Ø¯
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
// Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Logger NestJS
import { Logger } from '@nestjs/common';

private readonly logger = new Logger(FileUtils.name);

this.logger.error('Error deleting images:', error);
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Console.log Ø¯Ø± production performance Ø±Ø§ Ú©Ø§Ù‡Ø´ Ù…ÛŒâ€ŒØ¯Ù‡Ø¯
- Logger NestJS Ù‚Ø§Ø¨Ù„ÛŒØª log level Ø¯Ø§Ø±Ø¯
- Ù…ÛŒâ€ŒØªÙˆØ§Ù† Ø¯Ø± production ÙÙ‚Ø· error log Ú©Ø±Ø¯

---

#### 8. Ú©Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ù…Ù†Øª Ø´Ø¯Ù‡

**ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù…Ø´Ú©Ù„â€ŒØ¯Ø§Ø±:**

- `src/app.controller.ts` (Ø®Ø· 95-129)
- `src/main.ts` (Ø®Ø· 7-8, 18, 33)

**Ø±Ø§Ù‡ Ø­Ù„:**

- Ø§Ú¯Ø± Ú©Ø¯ Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª: **Ø­Ø°Ù Ú©Ù†**
- Ø§Ú¯Ø± Ù…Ù…Ú©Ù†Ù‡ Ø¨Ø¹Ø¯Ø§ Ù„Ø§Ø²Ù… Ø¨Ø§Ø´Ù‡: **Ø­ÙØ¸ Ø¯Ø± git history** Ùˆ Ø­Ø°Ù Ø§Ø² Ú©Ø¯

**Ø¨Ù‡ØªØ± Ø§Ø³Øª:**

```typescript
// âŒ Ø§ÛŒÙ† Ú©Ø¯ Ú©Ø§Ù…Ù†Øª Ø´Ø¯Ù‡ Ø±Ùˆ Ø­Ø°Ù Ú©Ù†
// @Delete('delete-image')
// ...

// âœ… ÛŒØ§ Ø§Ú¯Ø± ÙˆØ§Ù‚Ø¹Ø§ Ù„Ø§Ø²Ù…Ù‡ØŒ ØªÙˆÛŒ TODO comment Ø¨Ø°Ø§Ø±
// TODO: Implement delete-image endpoint if needed
```

---

### ğŸŸ¢ Ø¨Ù‡Ø¨ÙˆØ¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ

#### 9. Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ùˆ Branding

**Swagger Title:**
**ÙØ§ÛŒÙ„:** `src/main.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
.setTitle('Nest App') // âŒ generic Ø§Ø³Øª
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
.setTitle('Gold Gallery API')
.setDescription('Backend API for Gold Gallery E-commerce Platform')
.setVersion('1.0')
```

---

**CORS Configuration:**
**ÙØ§ÛŒÙ„:** `src/main.ts`

**Ù…Ø´Ú©Ù„:**

```typescript
app.enableCors(); // âŒ Ø®ÛŒÙ„ÛŒ open Ø§Ø³Øª
```

**Ø±Ø§Ù‡ Ø­Ù„:**

```typescript
app.enableCors({
  origin: process.env.FRONTEND_URL || 'http://localhost:4000',
  credentials: true,
  methods: ['GET', 'POST', 'PATCH', 'DELETE', 'PUT'],
  allowedHeaders: ['Content-Type', 'Authorization'],
});
```

**Ú†Ø±Ø§ Ù…Ù‡Ù… Ø§Ø³ØªØŸ**

- Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ±
- ÙÙ‚Ø· frontend Ù…Ø¬Ø§Ø² Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ù‡ API Ø¯Ø³ØªØ±Ø³ÛŒ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯

---

#### 10. Environment Variables

**Ø¨Ù‡ØªØ± Ø§Ø³Øª Ø§Ø² ConfigService Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´ÙˆØ¯:**

```typescript
// Ø¨Ù‡ Ø¬Ø§ÛŒ Ù…Ø³ØªÙ‚ÛŒÙ… process.env
const bankData = {
  merchant_id: process.env.MERCHANT_ID,
  // ...
};

// Ø¨Ù‡ØªØ± Ø§Ø³Øª:
constructor(
  private readonly configService: ConfigService,
) {}

const bankData = {
  merchant_id: this.configService.get<string>('MERCHANT_ID'),
  // ...
};
```

**Ù…Ø²Ø§ÛŒØ§:**

- Type-safe
- Validation Ø¯Ø± startup
- Default values

---

#### 11. ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø§Ø¶Ø§ÙÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø­ØµÙˆÙ„Ø§Øª Ø·Ù„Ø§

**ÙØ§ÛŒÙ„:** `src/product/schemas/product.schema.ts`

**ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:**

```typescript
@Schema({ timestamps: true })
export class Product extends Document {
  // ... ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯

  @Prop({ required: false })
  weight: number; // ÙˆØ²Ù† Ø¨Ù‡ Ú¯Ø±Ù…

  @Prop({ required: false })
  karat: number; // Ø¹ÛŒØ§Ø± (18, 21, 24)

  @Prop({
    required: false,
    enum: ['Ø¯Ø³ØªØ¨Ù†Ø¯', 'Ú¯Ø±Ø¯Ù†Ø¨Ù†Ø¯', 'Ø§Ù†Ú¯Ø´ØªØ±', 'Ú¯ÙˆØ´ÙˆØ§Ø±Ù‡', 'Ù¾Ø§Ø¨Ù†Ø¯', 'Ø³Ø§ÛŒØ±'],
  })
  type: string; // Ù†ÙˆØ¹ Ø¬ÙˆØ§Ù‡Ø±

  @Prop({
    required: false,
    enum: ['Ø·Ù„Ø§ÛŒ Ø²Ø±Ø¯', 'Ø·Ù„Ø§ÛŒ Ø³ÙÛŒØ¯', 'Ø·Ù„Ø§ÛŒ Ø±Ø²Ú¯Ù„Ø¯'],
  })
  material: string; // Ø¬Ù†Ø³ Ø·Ù„Ø§

  @Prop({ required: false })
  dimensions: string; // Ø§Ø¨Ø¹Ø§Ø¯

  @Prop({ default: false })
  hasCertificate: boolean; // Ú¯ÙˆØ§Ù‡ÛŒ Ø§ØµØ§Ù„Øª

  @Prop({ required: false })
  certificateNumber: string; // Ø´Ù…Ø§Ø±Ù‡ Ú¯ÙˆØ§Ù‡ÛŒ
}
```

**Ù‡Ù…Ú†Ù†ÛŒÙ† Ø¯Ø± DTO:**

**ÙØ§ÛŒÙ„:** `src/product/dtos/product.dto.ts`

```typescript
export class ProductDto {
  // ... ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…ÙˆØ¬ÙˆØ¯

  @IsNumber()
  @IsOptional()
  weight?: number;

  @IsNumber()
  @IsOptional()
  karat?: number;

  @IsString()
  @IsOptional()
  type?: string;

  @IsString()
  @IsOptional()
  material?: string;

  @IsString()
  @IsOptional()
  dimensions?: string;

  @IsBoolean()
  @IsOptional()
  hasCertificate?: boolean;

  @IsString()
  @IsOptional()
  certificateNumber?: string;
}
```

---

#### 12. Error Handling Ø¨Ù‡ØªØ±

**Ø³Ø§Ø®Øª ÛŒÚ© Custom Exception Filter:**

```typescript
// src/shared/filters/http-exception.filter.ts
@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse();
    const status = exception.getStatus();

    response.status(status).json({
      statusCode: status,
      message: exception.message,
      timestamp: new Date().toISOString(),
      path: ctx.getRequest().url,
    });
  }
}
```

---

#### 13. Validation Messages Ø¨Ù‡ØªØ±

**Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¯Ø± Validation:**

```typescript
// Ø¯Ø± DTOÙ‡Ø§
export class ProductDto {
  @IsString({ message: 'Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„ Ø§Ù„Ø²Ø§Ù…ÛŒ Ø§Ø³Øª' })
  @IsNotEmpty({ message: 'Ø¹Ù†ÙˆØ§Ù† Ù…Ø­ØµÙˆÙ„ Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø®Ø§Ù„ÛŒ Ø¨Ø§Ø´Ø¯' })
  title: string;

  @IsNumber({}, { message: 'Ù‚ÛŒÙ…Øª Ø¨Ø§ÛŒØ¯ Ø¹Ø¯Ø¯ Ø¨Ø§Ø´Ø¯' })
  @Min(0, { message: 'Ù‚ÛŒÙ…Øª Ù†Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù…Ù†ÙÛŒ Ø¨Ø§Ø´Ø¯' })
  price: number;
}
```

---

## ğŸ“ Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´ÛŒâ€ŒØ³Ø§Ø²ÛŒ Ø¨Ø±Ø§ÛŒ Gold Gallery

### ğŸ”´ Ø§ÙˆÙ„ÙˆÛŒØª Ø¨Ø§Ù„Ø§ (Ø¨Ø§ÛŒØ¯ ÙÙˆØ±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯)

- [ ] **Ø§ØµÙ„Ø§Ø­ Callback URL Ø¯Ø± Payment**
  - ÙØ§ÛŒÙ„: `src/shop/controllers/site-order.controller.ts`
  - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† URL ØµØ­ÛŒØ­ Ø¨Ø±Ø§ÛŒ redirect Ø¨Ø¹Ø¯ Ø§Ø² Ù¾Ø±Ø¯Ø§Ø®Øª
- [ ] **Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±Ø®ÙˆØ§Ø³Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù†Ú©ÛŒ**
  - ÙØ§ÛŒÙ„: `src/shop/services/order.service.ts`
  - Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† try-catch Ø¨Ø±Ø§ÛŒ axios requests
- [ ] **Type Safety Ø¨Ø±Ø§ÛŒ Callback Query**
  - ÙØ§ÛŒÙ„: `src/shop/controllers/site-order.controller.ts`
  - Ø§ÛŒØ¬Ø§Ø¯ DTO Ø¨Ø±Ø§ÛŒ callback parameters

- [ ] **Ø­Ø°Ù Console.log Ø§Ø² Production Code**
  - ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: `file-utils.ts`, `seo.service.ts`, `user.service.ts`, `api-key.guard.ts`
  - Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¨Ø§ NestJS Logger

### ğŸŸ¡ Ø§ÙˆÙ„ÙˆÛŒØª Ù…ØªÙˆØ³Ø· (Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø§Ø³Ø±Ø¹ ÙˆÙ‚Øª Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯)

- [ ] **Ø§ØµÙ„Ø§Ø­ Typo "errrors"**
  - ÙØ§ÛŒÙ„: `src/shared/pipes/farsi.pipe.ts`
- [ ] **Ø­Ø°Ù Import Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù†Ø´Ø¯Ù‡**
  - ÙØ§ÛŒÙ„: `src/app.module.ts`
- [ ] **Ø­Ø°Ù Ú©Ø¯Ù‡Ø§ÛŒ Ú©Ø§Ù…Ù†Øª Ø´Ø¯Ù‡**
  - ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: `app.controller.ts`, `main.ts`
- [ ] **ØªØºÛŒÛŒØ± Swagger Title**
  - ÙØ§ÛŒÙ„: `src/main.ts`
  - ØªØºÛŒÛŒØ± Ø¨Ù‡ "Gold Gallery API"
- [ ] **ØªÙ†Ø¸ÛŒÙ… CORS**
  - ÙØ§ÛŒÙ„: `src/main.ts`
  - Ù…Ø­Ø¯ÙˆØ¯ Ú©Ø±Ø¯Ù† Ø¨Ù‡ frontend URL

### ğŸŸ¢ Ø§ÙˆÙ„ÙˆÛŒØª Ù¾Ø§ÛŒÛŒÙ† (Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ø¨Ø¹Ø¯Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´ÙˆØ¯)

- [ ] **Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ConfigService**
  - Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ø±Ø¯Ù† process.env Ù…Ø³ØªÙ‚ÛŒÙ…
- [ ] **Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø·Ù„Ø§**
  - ÙˆØ²Ù†ØŒ Ø¹ÛŒØ§Ø±ØŒ Ù†ÙˆØ¹ØŒ Ø¬Ù†Ø³ØŒ Ø§Ø¨Ø¹Ø§Ø¯ØŒ Ú¯ÙˆØ§Ù‡ÛŒ
  - ÙØ§ÛŒÙ„â€ŒÙ‡Ø§: `product.schema.ts`, `product.dto.ts`
- [ ] **Ø¨Ù‡Ø¨ÙˆØ¯ Error Handling**
  - Ø§ÛŒØ¬Ø§Ø¯ Custom Exception Filter
  - Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ø®Ø·Ø§ÛŒ ÛŒÚ©Ù¾Ø§Ø±Ú†Ù‡
- [ ] **Ø¨Ù‡Ø¨ÙˆØ¯ Validation Messages**
  - Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ø¯Ø± DTOÙ‡Ø§
- [ ] **Refactoring Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² `any`**
  - Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ†ÛŒ Ø¨Ø§ ØªØ§ÛŒÙ¾â€ŒÙ‡Ø§ÛŒ Ø¯Ù‚ÛŒÙ‚ Ø¯Ø± Ù‡Ù…Ù‡ serviceÙ‡Ø§

---

## ğŸ› ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ

### Ù…Ø±Ø­Ù„Ù‡ 1: Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ

#### 1.1 Ø§ØµÙ„Ø§Ø­ Callback URL

```typescript
// src/shop/controllers/site-order.controller.ts
async callback(@Query() query: PaymentCallbackDto, @Res() response: Response) {
  if (query.authority) {
    const order = await this.orderService.findOrderByRefId(query.authority);
    const bankResponse = await this.orderService.checkOrder(
      (order._id as Types.ObjectId).toString(),
    );

    if (bankResponse.status === 101) {
      order.status = OrderStatus.Paid;
      await this.cartService.removeCartAndItems(order.cart.toString());
      await order.save();
      return response.redirect(
        `${process.env.FRONTEND_URL}/order/success?id=${order._id}`
      );
    } else {
      order.status = OrderStatus.Canceled;
      await order.save();
      return response.redirect(
        `${process.env.FRONTEND_URL}/order/failed?id=${order._id}`
      );
    }
  } else {
    return response.redirect(`${process.env.FRONTEND_URL}/order/failed`);
  }
}
```

#### 1.2 Ø§ÛŒØ¬Ø§Ø¯ DTO Ø¨Ø±Ø§ÛŒ Callback

```typescript
// src/shop/dtos/payment-callback.dto.ts
import { IsString, IsOptional } from 'class-validator';

export class PaymentCallbackDto {
  @IsString()
  @IsOptional()
  authority?: string;

  @IsString()
  @IsOptional()
  status?: string;
}
```

#### 1.3 Ù…Ø¯ÛŒØ±ÛŒØª Ø®Ø·Ø§ Ø¯Ø± Payment Service

```typescript
// src/shop/services/order.service.ts
async checkOrder(id: string) {
  try {
    const order = await this.findOneOrder(id);
    const bankData = {
      merchant_id: process.env.MERCHANT_ID,
      amount: order.finalPrice * 10,
      authority: order.refId,
    };

    const response = await axios.post(process.env.BANK_VERIFY_URL!, bankData);
    return response?.data?.data;
  } catch (error) {
    throw new BadRequestException('Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø¯Ø±Ú¯Ø§Ù‡ Ø¨Ø§Ù†Ú©ÛŒ');
  }
}

async createPaymentRequest(finalPrice: number) {
  try {
    const bankData = {
      merchant_id: process.env.MERCHANT_ID,
      amount: finalPrice * 10,
      description: 'Ø³ÙØ§Ø±Ø´ Ø§Ø² Gold Gallery',
      callback_url: `${process.env.SERVER_URL}/site/order/callback`,
    };

    const response = await axios.post(process.env.BANK_URL!, bankData);
    return response?.data?.data;
  } catch (error) {
    throw new BadRequestException('Ø®Ø·Ø§ Ø¯Ø± Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ù¾Ø±Ø¯Ø§Ø®Øª');
  }
}
```

---

### Ù…Ø±Ø­Ù„Ù‡ 2: Ø¨Ù‡Ø¨ÙˆØ¯ Ú©ÛŒÙÛŒØª Ú©Ø¯

#### 2.1 Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Logger

```typescript
// src/shared/utils/file-utils.ts
import { Logger } from '@nestjs/common';

const logger = new Logger('FileUtils');

export const deleteImages = async (fileName: string, folder: string) => {
  // ...
  try {
    await fs.promises.unlink(`${imagePath}/main/${fileName}`);
    await fs.promises.unlink(`${imagePath}/resized/${fileName}`);
    return { success: true, message: 'Images deleted successfully' };
  } catch (error) {
    logger.error(`Error deleting images: ${error.message}`, error.stack);
    throw new Error(`Failed to delete images: ${error.message}`);
  }
};
```

#### 2.2 ØªÙ†Ø¸ÛŒÙ… Swagger Ùˆ CORS

```typescript
// src/main.ts
const config = new DocumentBuilder()
  .setTitle('Gold Gallery API')
  .setDescription('Backend API for Gold Gallery E-commerce Platform')
  .setVersion('1.0')
  .addBearerAuth()
  .build();

app.enableCors({
  origin: process.env.FRONTEND_URL || 'http://localhost:4000',
  credentials: true,
  methods: ['GET', 'POST', 'PATCH', 'DELETE', 'PUT'],
  allowedHeaders: ['Content-Type', 'Authorization'],
});
```

---

### Ù…Ø±Ø­Ù„Ù‡ 3: Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø·Ù„Ø§

#### 3.1 Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Schema

```typescript
// src/product/schemas/product.schema.ts
@Prop({ required: false })
weight: number;

@Prop({ required: false })
karat: number;

@Prop({
  required: false,
  enum: ['Ø¯Ø³ØªØ¨Ù†Ø¯', 'Ú¯Ø±Ø¯Ù†Ø¨Ù†Ø¯', 'Ø§Ù†Ú¯Ø´ØªØ±', 'Ú¯ÙˆØ´ÙˆØ§Ø±Ù‡', 'Ù¾Ø§Ø¨Ù†Ø¯', 'Ø³Ø§ÛŒØ±']
})
type: string;

@Prop({
  required: false,
  enum: ['Ø·Ù„Ø§ÛŒ Ø²Ø±Ø¯', 'Ø·Ù„Ø§ÛŒ Ø³ÙÛŒØ¯', 'Ø·Ù„Ø§ÛŒ Ø±Ø²Ú¯Ù„Ø¯']
})
material: string;

@Prop({ required: false })
dimensions: string;

@Prop({ default: false })
hasCertificate: boolean;

@Prop({ required: false })
certificateNumber: string;
```

#### 3.2 Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ DTO

```typescript
// src/product/dtos/product.dto.ts
@IsNumber()
@IsOptional()
@Min(0)
weight?: number;

@IsNumber()
@IsOptional()
@IsIn([18, 21, 24])
karat?: number;

@IsString()
@IsOptional()
@IsIn(['Ø¯Ø³ØªØ¨Ù†Ø¯', 'Ú¯Ø±Ø¯Ù†Ø¨Ù†Ø¯', 'Ø§Ù†Ú¯Ø´ØªØ±', 'Ú¯ÙˆØ´ÙˆØ§Ø±Ù‡', 'Ù¾Ø§Ø¨Ù†Ø¯', 'Ø³Ø§ÛŒØ±'])
type?: string;

@IsString()
@IsOptional()
@IsIn(['Ø·Ù„Ø§ÛŒ Ø²Ø±Ø¯', 'Ø·Ù„Ø§ÛŒ Ø³ÙÛŒØ¯', 'Ø·Ù„Ø§ÛŒ Ø±Ø²Ú¯Ù„Ø¯'])
material?: string;

@IsString()
@IsOptional()
dimensions?: string;

@IsBoolean()
@IsOptional()
hasCertificate?: boolean;

@IsString()
@IsOptional()
certificateNumber?: string;
```

---

## ğŸ“‹ Environment Variables Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø²

```env
# JWT
JWT_SECRET=your-super-secret-jwt-key-min-32-chars

# Database
MONGODB_URI=mongodb://localhost:27017/horsegallery

# Server
PORT=4001
SERVER_URL=http://localhost:4001
FRONTEND_URL=http://localhost:4000

# Payment Gateway
MERCHANT_ID=your-merchant-id
BANK_URL=https://bank-gateway-url.com/api/payment/request
BANK_VERIFY_URL=https://bank-gateway-url.com/api/payment/verify

# Optional
API_KEY=your-api-key-if-needed
```

---

## ğŸ” ØªØ³Øª Ú©Ø±Ø¯Ù† ØªØºÛŒÛŒØ±Ø§Øª

### 1. ØªØ³Øª Authentication

```bash
# Test invalid token
curl -X GET http://localhost:4001/user \
  -H "Authorization: Bearer invalid-token"
# Ø¨Ø§ÛŒØ¯ 401 Ø¨Ø±Ú¯Ø±Ø¯Ø§Ù†Ø¯
```

### 2. ØªØ³Øª Payment Callback

```bash
# Test callback Ø¨Ø§ authority
curl -X GET "http://localhost:4001/site/order/callback?authority=test123"
# Ø¨Ø§ÛŒØ¯ Ø¨Ù‡ frontend redirect Ú©Ù†Ø¯
```

### 3. ØªØ³Øª Product Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯

```bash
# Test create product Ø¨Ø§ ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø·Ù„Ø§
curl -X POST http://localhost:4001/product \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "Ø¯Ø³ØªØ¨Ù†Ø¯ Ø·Ù„Ø§",
    "weight": 25.5,
    "karat": 18,
    "type": "Ø¯Ø³ØªØ¨Ù†Ø¯",
    "material": "Ø·Ù„Ø§ÛŒ Ø²Ø±Ø¯",
    "hasCertificate": true
  }'
```

---

## ğŸ“š Ù…Ù†Ø§Ø¨Ø¹ Ù…ÙÛŒØ¯

- [NestJS Documentation](https://docs.nestjs.com/)
- [NestJS Security Best Practices](https://docs.nestjs.com/security/authentication)
- [TypeScript Best Practices](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)
- [MongoDB Best Practices](https://docs.mongodb.com/manual/administration/production-notes/)

---

## âœ… Ù†ØªÛŒØ¬Ù‡â€ŒÚ¯ÛŒØ±ÛŒ

Ù¾Ø±ÙˆÚ˜Ù‡ Ø´Ù…Ø§ Ø³Ø§Ø®ØªØ§Ø± Ø®ÙˆØ¨ÛŒ Ø¯Ø§Ø±Ø¯ Ùˆ Ø¨Ø±Ø§ÛŒ Gold Gallery Ù‚Ø§Ø¨Ù„ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ø§ Ø§Ù†Ø¬Ø§Ù… ØªØºÛŒÛŒØ±Ø§Øª Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ:

1. **Ø§Ù…Ù†ÛŒØª** Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯
2. **Ú©ÛŒÙÛŒØª Ú©Ø¯** Ø¨Ø§Ù„Ø§ Ù…ÛŒâ€ŒØ±ÙˆØ¯
3. **Ù‚Ø§Ø¨Ù„ÛŒØª Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ** Ø§ÙØ²Ø§ÛŒØ´ Ù…ÛŒâ€ŒÛŒØ§Ø¨Ø¯
4. **ØªØ¬Ø±Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø±ÛŒ** Ø¨Ù‡ØªØ± Ù…ÛŒâ€ŒØ´ÙˆØ¯

**ØªÙˆØµÛŒÙ‡:** ØªØºÛŒÛŒØ±Ø§Øª Ø±Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ù…Ø±Ø­Ù„Ù‡â€ŒØ§ÛŒ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯:

- Ù‡ÙØªÙ‡ 1: Ù…Ø´Ú©Ù„Ø§Øª Ø§Ù…Ù†ÛŒØªÛŒ
- Ù‡ÙØªÙ‡ 2: Ø¨Ù‡Ø¨ÙˆØ¯ Ú©ÛŒÙÛŒØª Ú©Ø¯
- Ù‡ÙØªÙ‡ 3: Ø§ÙØ²ÙˆØ¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø­ØµÙˆÙ„ Ø·Ù„Ø§
- Ù‡ÙØªÙ‡ 4: ØªØ³Øª Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ

---

**ØªÙ‡ÛŒÙ‡ Ø´Ø¯Ù‡ Ø¯Ø±:** 2025-02-11  
**Ù†Ø³Ø®Ù‡:** 1.0
