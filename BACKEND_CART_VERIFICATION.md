# โ ุจุฑุฑุณ ุตุญุช ูพุงุฏูโุณุงุฒ ุณุจุฏ ุฎุฑุฏ - Backend

**ุชุงุฑุฎ:** ุฏุณุงูุจุฑ 2024

**ูุถุนุช:** โ **ููู ฺุฒ ูพุงุฏูโุณุงุฒ ุดุฏู ู ุฏุฑุณุช ุงุณุช**

---

## ๐ ุฎูุงุตู

ุงู doc ุจุฑุง ุจุฑุฑุณ ุตุญุช ูพุงุฏูโุณุงุฒ ูุญุงุณุจุงุช ุณุจุฏ ุฎุฑุฏ ุฏุฑ Backend ุงุณุช. ููู ูุญุงุณุจุงุช ุจุงุฏ ุฏุฑ Backend ุงูุฌุงู ุดูุฏ ู Frontend ููุท ุฏุงุฏูโูุง ุฑุง ููุงุด ูโุฏูุฏ.

**โ ููู ููุงุฑุฏ ุจุฑุฑุณ ุดุฏ ู ุฏุฑุณุช ุงุณุช.**

---

## ๐ ฺฺฉโูุณุช ุจุฑุฑุณ

### 1๏ธโฃ ุจุฑุฑุณ ููุฏูุง CartItem โ

ุจุฑุง ูุฑ `CartItem` ุฏุฑ responseุ ุจุฑุฑุณ ฺฉูุฏ:

- [x] `price`: ููุช ฺฉู (ุจุง ุชุฎูู) ุจุฑุง quantity ูุนู โ
- [x] `originalPrice`: ููุช ฺฉู ุงุตู (ุจุฏูู ุชุฎูู) ุจุฑุง quantity ูุนู โ
- [x] `unitPrice`: ููุช ูุงุญุฏ (ุจุง ุชุฎูู) โ
- [x] `unitOriginalPrice`: ููุช ูุงุญุฏ ุงุตู (ุจุฏูู ุชุฎูู) โ
- [x] `discount`: ุฏุฑุตุฏ ุชุฎูู (ุนุฏุฏ) โ

**โ ุฏุฑุณุช:**

```json
{
  "quantity": 2,
  "price": 10000000, // โ ุจุฑุง quantity = 2 (5000000 * 2)
  "originalPrice": 12000000, // โ ุจุฑุง quantity = 2 (6000000 * 2)
  "unitPrice": 5000000, // โ ููุช ูุงุญุฏ
  "unitOriginalPrice": 6000000 // โ ููุช ูุงุญุฏ ุงุตู
}
```

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุทูุท 392-444

---

### 2๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู ููุช ุจุฑุง quantity = 1 โ

**โ ุฏุฑุณุช:** `price === unitPrice` ู `originalPrice === unitOriginalPrice`

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุท 412

---

### 3๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู ููุช ุจุฑุง quantity = 2 โ

**โ ุฏุฑุณุช:**

- `price === unitPrice * quantity` โ
- `originalPrice === unitOriginalPrice * quantity` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุทูุท 412 ู 399

---

### 4๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู ุฏุฑุตุฏ ุชุฎูู โ

**โ ุฏุฑุณุช:**

- ุงฺฏุฑ `discountPrice < price`: `discount = Math.round(((price - discountPrice) / price) * 100)` โ
- ุงฺฏุฑ `discountPrice === null` ุง `discountPrice >= price`: `discount = 0` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุทูุท 418-433

---

### 5๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู totalItems โ

**โ ุฏุฑุณุช:** `totalItems === sum of all item.quantity`

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุทูุท 375-378

---

### 6๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู totalPrice โ

**โ ุฏุฑุณุช:**

- `totalPrice === sum of all item.price` โ
- `totalPrice === prices.totalWithDiscount` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุท 452

---

### 7๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู prices โ

**โ ุฏุฑุณุช:**

- `totalWithoutDiscount === sum of all item.originalPrice` โ
- `totalWithDiscount === sum of all item.price` โ
- `totalSavings === totalWithoutDiscount - totalWithDiscount` โ
- `savingsPercentage === Math.round((totalSavings / totalWithoutDiscount) * 100)` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ูุชุฏ `getPrices` (ุฎุทูุท 462-512)

---

### 8๏ธโฃ ุจุฑุฑุณ ูุญุงุณุจู remainingSeconds โ

**โ ุฏุฑุณุช:**

- `remainingSeconds` ุจุฑ ุงุณุงุณ `expiresAt` ู ุฒูุงู ูุนู ูุญุงุณุจู ูโุดูุฏ โ
- ุงฺฏุฑ `expiresAt` ฺฏุฐุดุชู ุจุงุดุฏุ `remainingSeconds = 0` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุทูุท 383-389

---

### 9๏ธโฃ ุจุฑุฑุณ ุจูโุฑูุฒุฑุณุงู quantity โ

**โ ุฏุฑุณุช:**

- ููุช `quantity` ุชุบุฑ ูโฺฉูุฏุ `price` ู `originalPrice` ุฏูุจุงุฑู ูุญุงุณุจู ูโุดููุฏ โ
- `unitPrice` ู `unitOriginalPrice` ุชุบุฑ ููโฺฉููุฏ โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ูุชุฏ `editCart` (ุฎุทูุท 524-588)

**ูฺฉุชู:** ุจุนุฏ ุงุฒ ุชุบุฑ `quantity`ุ `getCartDetails` ูุฑุงุฎูุงู ูโุดูุฏ ฺฉู ููู ููุชโูุง ุฑุง ุฏูุจุงุฑู ูุญุงุณุจู ูโฺฉูุฏ.

---

### ๐ ุจุฑุฑุณ ูุญุตูู ุจุฏูู ุชุฎูู โ

**โ ุฏุฑุณุช:**

- ุงฺฏุฑ `discountPrice === null`: `unitPrice === product.price` โ
- `price === originalPrice` โ
- `discount === 0` โ

**๐ ูุญู ูพุงุฏูโุณุงุฒ:** `src/shop/services/cart.service.ts` ุฎุท 405 (ุงุณุชูุงุฏู ุงุฒ `??`)

---

## ๐งช ุชุณุชโูุง ุฌุงูุน

### ุชุณุช 1: ุณุจุฏ ุจุง ฺูุฏ ูุญุตูู ูุฎุชูู โ

**โ ููู ููุงุฑุฏ ุฏุฑุณุช ุงุณุช:**

- `itemCount` ูุญุงุณุจู ูโุดูุฏ โ
- `totalItems` ูุญุงุณุจู ูโุดูุฏ โ
- `totalPrice` ูุญุงุณุจู ูโุดูุฏ โ
- `prices` ููู ููุฏูุง ูุญุงุณุจู ูโุดููุฏ โ
- `remainingSeconds` ูุญุงุณุจู ูโุดูุฏ โ

---

### ุชุณุช 2: ุชุบุฑ quantity โ

**โ ุฏุฑุณุช:**

- ููุช `quantity` ุชุบุฑ ูโฺฉูุฏุ `price` ู `originalPrice` ุจูโุฑูุฒ ูโุดููุฏ โ
- `unitPrice` ู `unitOriginalPrice` ุจุฏูู ุชุบุฑ ูโูุงููุฏ โ
- `totalItems` ู `totalPrice` ุจูโุฑูุฒ ูโุดููุฏ โ

---

### ุชุณุช 3: ุชุงูุฑ (remainingSeconds) โ

**โ ุฏุฑุณุช:**

- `remainingSeconds` ูุฑ ุจุงุฑ ูุญุงุณุจู ูโุดูุฏ (ูู cache ูโุดูุฏ) โ
- ุจุฑ ุงุณุงุณ `expiresAt` ู ุฒูุงู ูุนู ุงุณุช โ

---

## โ๏ธ ูุดฺฉูุงุช ุฑุงุฌ - ููู ุญู ุดุฏู โ

### ูุดฺฉู 1: `price` ุจุฑุง quantity = 1 ูุญุงุณุจู ูโุดูุฏ โ

**โ ุญู ุดุฏู:** `price` ุจุฑุง quantity ูุนู ูุญุงุณุจู ูโุดูุฏ

---

### ูุดฺฉู 2: `totalPrice` ูุญุงุณุจู ููโุดูุฏ โ

**โ ุญู ุดุฏู:** `totalPrice` ุงุฒ `prices.totalWithDiscount` ูุญุงุณุจู ูโุดูุฏ

---

### ูุดฺฉู 3: `remainingSeconds` ูุญุงุณุจู ููโุดูุฏ โ

**โ ุญู ุดุฏู:** `remainingSeconds` ุฏุฑ `getCartDetails` ูุญุงุณุจู ูโุดูุฏ

---

### ูุดฺฉู 4: `unitPrice` ู `unitOriginalPrice` ูุฌูุฏ ูุฏุงุฑูุฏ โ

**โ ุญู ุดุฏู:** ุงู ููุฏูุง ุฏุฑ response ุงุถุงูู ุดุฏูโุงูุฏ

---

## ๐ ฺฺฉโูุณุช ููุง

### ุจุฑุง ูุฑ CartItem: โ

- [x] `price` ุจุฑุง quantity ูุนู ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `originalPrice` ุจุฑุง quantity ูุนู ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `unitPrice` ูุฌูุฏ ุฏุงุฑุฏ โ
- [x] `unitOriginalPrice` ูุฌูุฏ ุฏุงุฑุฏ โ
- [x] `discount` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `price === unitPrice * quantity` โ
- [x] `originalPrice === unitOriginalPrice * quantity` โ

### ุจุฑุง CartResponse: โ

- [x] `itemCount` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `totalItems` ูุญุงุณุจู ุดุฏู ุงุณุช (ูุฌููุน quantity) โ
- [x] `totalPrice` ูุญุงุณุจู ุดุฏู ุงุณุช (ูุฌููุน price) โ
- [x] `remainingSeconds` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `prices.totalWithoutDiscount` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `prices.totalWithDiscount` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `prices.totalSavings` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `prices.savingsPercentage` ูุญุงุณุจู ุดุฏู ุงุณุช โ
- [x] `totalPrice === prices.totalWithDiscount` โ

### ุชุณุชโูุง: โ

- [x] ุชุณุช ุจุง quantity = 1 โ
- [x] ุชุณุช ุจุง quantity = 2 โ
- [x] ุชุณุช ุจุง quantity = 5 โ
- [x] ุชุณุช ุจุง ูุญุตููุงุช ุจุง ุชุฎูู โ
- [x] ุชุณุช ุจุง ูุญุตููุงุช ุจุฏูู ุชุฎูู โ
- [x] ุชุณุช ุชุบุฑ quantity โ
- [x] ุชุณุช ุชุงูุฑ (remainingSeconds) โ
- [x] ุชุณุช ูุฌููุน ููุชโูุง โ

---

## ๐ฏ ุฎูุงุตู

### โ ุจุฑุฑุณ ุดุฏู:

1. **`price` ู `originalPrice` ุจุฑุง quantity ูุนู ูุณุชูุฏ** โ
2. **`unitPrice` ู `unitOriginalPrice` ูุฌูุฏ ุฏุงุฑูุฏ** โ
3. **`discount` ูุญุงุณุจู ุดุฏู ุงุณุช** โ
4. **`totalPrice` ู `totalItems` ูุญุงุณุจู ุดุฏูโุงูุฏ** โ
5. **`remainingSeconds` ูุญุงุณุจู ุดุฏู ุงุณุช** โ
6. **`prices` ููู ููุฏูุง ูุญุงุณุจู ุดุฏูโุงูุฏ** โ

### โ ููู ฺุฒ ุฏุฑุณุช ุงุณุช:

1. **`price` ุจุฑุง quantity ูุนู ุงุณุช** โ
2. **`totalPrice` ูุญุงุณุจู ุดุฏู ุงุณุช** โ
3. **`remainingSeconds` ูุญุงุณุจู ุดุฏู ุงุณุช** โ
4. **`unitPrice` ู `unitOriginalPrice` ูุฌูุฏ ุฏุงุฑูุฏ** โ

---

## ๐ ูุญู ูพุงุฏูโุณุงุฒ

### ูุงู ุงุตู:

- `src/shop/services/cart.service.ts`

### ูุชุฏูุง ฺฉูุฏ:

1. **`getCartDetails`** (ุฎุท 356): ูุญุงุณุจู ููู ููุฏูุง response
2. **`getPrices`** (ุฎุท 462): ูุญุงุณุจู `prices` object
3. **`editCart`** (ุฎุท 524): ุจูโุฑูุฒุฑุณุงู quantity ู ูุญุงุณุจู ูุฌุฏุฏ ููุชโูุง

### ููุทู ูุญุงุณุจู:

1. **ูุญุงุณุจู ููุช ูุงุญุฏ:** ุฎุทูุท 407-415
2. **ูุญุงุณุจู ููุช ฺฉู:** ุฎุทูุท 399 ู 412
3. **ูุญุงุณุจู ุฏุฑุตุฏ ุชุฎูู:** ุฎุทูุท 418-433
4. **ูุญุงุณุจู totalItems:** ุฎุทูุท 375-378
5. **ูุญุงุณุจู remainingSeconds:** ุฎุทูุท 383-389

---

## ๐ ูพุดุชุจุงู

ุงฺฏุฑ ูุดฺฉู ุฏุงุดุชุฏ:

1. โ Response ุฑุง ุฏุฑ Console/Network tab ุจุฑุฑุณ ฺฉูุฏ
2. โ ููุงุฏุฑ ุฑุง ุจุง ูุฑูููโูุง ุจุงูุง ููุงุณู ฺฉูุฏ
3. โ ุชุณุชโูุง ุจุงูุง ุฑุง ุงุฌุฑุง ฺฉูุฏ
4. โ ุจุง Frontend ุชู ููุงููฺฏ ฺฉูุฏ

---

**โ ููู ฺุฒ ุฏุฑุณุช ุงุณุช ู ุขูุงุฏู ุงุณุชูุงุฏู ุงุณุช! ๐**
